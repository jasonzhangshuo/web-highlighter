# Web Highlighter 配置与使用指南

按下面步骤做完，即可在网页/微信读书里高亮并保存到本地。

---

## 一、环境要求

- **Node.js**：建议 v16+（用于跑本地服务）
- **Chrome / Edge** 等 Chromium 内核浏览器（用于安装扩展）

---

## 二、配置步骤

### 1. 启动本地服务（必做）

本地服务是「数据中心」：扩展把高亮发到这里，Dashboard 和 API 都从这里读数据。

```bash
cd server
npm install
npm start
```

- 服务默认跑在 **http://localhost:3100**
- 首次启动会自动创建 `server/database.json`，无需手动新建
- 若想换端口，可：`PORT=3200 npm start`（同时需要改扩展里的 API 地址，见下文「可选配置」）

看到类似输出即成功：

```
🚀 服务已启动: http://localhost:3100
📊 管理界面: http://localhost:3100/dashboard
📡 API 地址: http://localhost:3100/api/highlights
```

### 2. 安装浏览器扩展（必做）

1. 打开 Chrome，地址栏输入：`chrome://extensions/`
2. 右上角打开 **「开发者模式」**
3. 点击 **「加载已解压的扩展程序」**
4. 选择本仓库里的 **`extension`** 目录（即包含 `manifest.json` 的那一层）

安装成功后，扩展会出现在扩展列表里，名称是「Web Highlighter」。

### 3. 无需额外配置即可使用

- 扩展默认连 **http://localhost:3100**，与上面默认端口一致
- 数据只存本机，不需要账号、API Key 或数据库配置

---

## 三、使用方式

| 场景 | 操作 |
|------|------|
| **微信读书** | 打开 [weread.qq.com](https://weread.qq.com) → 用自带马克笔划线或选中文字 → 点工具栏 **「复制」** → 自动保存到本地 |
| **任意网页** | 选中文字 → 右键选 **「💡 保存到 Web Highlighter」**，或点扩展图标用弹窗保存 |
| **随手记** | 在任意网页按 **Ctrl+Shift+U**（Mac：**Command+Shift+U**）→ 弹出输入框，记录想法后点「保存」，会以当前页面为来源存入高亮库 |
| **查看 / 导出** | 浏览器打开 **http://localhost:3100/dashboard**：列表、搜索、按域名/日期筛选、导出 JSON/Markdown、删除 |

---

## 四、可选配置

### 换端口（例如改用 3200）

1. **服务端**：在 `server` 目录下执行  
   `PORT=3200 npm start`
2. **扩展**：把下面 3 个文件里的 `http://localhost:3100` 改成 `http://localhost:3200`：
   - `extension/background.js`（第 4 行 `SERVER_URL`）
   - `extension/content.js`（第 11 行 `SERVER_URL`）
   - `extension/popup.js`（第 3 行 `SERVER_URL`）
3. **manifest**：在 `extension/manifest.json` 里把 `3100` 改成 `3200`（`host_permissions` 和 `exclude_matches` 两处）。
4. 到 `chrome://extensions/` 对 Web Highlighter 点 **「重新加载」**。

### 数据文件位置

- 高亮数据在：**`server/database.json`**
- 可直接备份、复制或清空该文件（清空后建议保留 `{"highlights":[]}` 结构）。

---

## 五、常见问题

| 问题 | 处理 |
|------|------|
| 扩展提示「保存失败」 | 先确认 `cd server && npm start` 已运行，且浏览器能打开 http://localhost:3100/dashboard |
| 微信读书点复制没反应 | 确保选中的是页面里的文字再点「复制」；若仍不行，看浏览器控制台是否有报错 |
| 想改 API 地址 | 当前需改扩展内 3 处 `SERVER_URL` 和 manifest 的端口，见「换端口」 |

更多 API 与字段说明见 **`docs/API.md`**。
